openapi: 3.0.0
info:
  title: Stark Byte Hub API
  version: 1.0.0
  description: Documentation de l’API du backend Stark Byte Hub
servers:
  - url: http://localhost:5000
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: token
paths:
  /auth/register:
    post:
      summary: Inscription d’un nouvel utilisateur
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - firstName
                - lastName
              properties:
                email:
                  type: string
                password:
                  type: string
                firstName:
                  type: string
                lastName:
                  type: string
      responses:
        "201":
          description: Utilisateur créé avec succès
        "400":
          description: Erreur de validation
  /auth/login:
    post:
      summary: Connexion d’un utilisateur
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: Connexion réussie
        "400":
          description: Identifiants invalides
  /auth/logout:
    post:
      summary: Déconnexion de l’utilisateur
      tags:
        - Auth
      responses:
        "200":
          description: Déconnecté avec succès
  /auth/me:
    get:
      summary: Récupère les infos de l’utilisateur connecté
      tags:
        - Auth
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Utilisateur connecté
        "401":
          description: Non autorisé
  /auth/profile:
    patch:
      summary: Mise à jour du profil utilisateur
      tags:
        - Auth
      security:
        - cookieAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                address:
                  type: string
                address2:
                  type: string
                zipCode:
                  type: string
                city:
                  type: string
                country:
                  type: string
      responses:
        "200":
          description: Profil mis à jour
        "401":
          description: Non autorisé
  /auth/forgot-password:
    post:
      summary: Demande de réinitialisation de mot de passe
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
      responses:
        "200":
          description: Email envoyé
        "404":
          description: Utilisateur non trouvé
  /auth/reset-password:
    post:
      summary: Réinitialise le mot de passe avec un token
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                newPassword:
                  type: string
      responses:
        "200":
          description: Mot de passe réinitialisé
        "400":
          description: Token invalide ou expiré
  /download/firmwares:
    get:
      summary: Liste les firmwares disponibles
      tags:
        - Download
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des fichiers firmware
  /download/firmwares/{filename}:
    get:
      summary: Télécharge un fichier firmware
      tags:
        - Download
      security:
        - cookieAuth: []
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
          description: Nom du fichier firmware
      responses:
        "200":
          description: Fichier téléchargé
        "404":
          description: Fichier introuvable
  /download/robots.csv:
    get:
      summary: Export CSV des robots
      tags:
        - Download
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Fichier CSV généré
        "403":
          description: Permission refusée
  /logs/login:
    get:
      summary: Liste les connexions réussies des utilisateurs
      tags:
        - Logs
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: userId
          schema:
            type: string
          description: ID de l'utilisateur
        - in: query
          name: ip
          schema:
            type: string
          description: Adresse IP à filtrer
        - in: query
          name: since
          schema:
            type: string
            format: date-time
          description: Date de début (ISO 8601)
        - in: query
          name: until
          schema:
            type: string
            format: date-time
          description: Date de fin (ISO 8601)
      responses:
        "200":
          description: Liste des connexions
        "403":
          description: Accès refusé
    delete:
      summary: Supprime tous les logs de connexion
      tags:
        - Logs
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Tous les logs ont été supprimés
        "403":
          description: Accès refusé
  /logs/stats:
    get:
      summary: Statistiques sur les connexions utilisateurs
      tags:
        - Logs
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Statistiques des connexions
        "403":
          description: Accès refusé
  /logs/login/{id}:
    delete:
      summary: Supprime un log de connexion par ID
      tags:
        - Logs
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID du log à supprimer
      responses:
        "204":
          description: Log supprimé
        "403":
          description: Accès refusé
        "404":
          description: Log non trouvé
  /modules:
    get:
      summary: Liste tous les modules disponibles
      tags:
        - Modules
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des modules disponibles
  /modules/enabled:
    get:
      summary: Liste des modules activés pour l'utilisateur connecté
      tags:
        - Modules
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des modules activés
  /modules/{id}/enable:
    patch:
      summary: Active un module pour l'utilisateur
      tags:
        - Modules
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: ID du module à activer
          schema:
            type: string
      responses:
        "200":
          description: Module activé
  /modules/{id}/disable:
    patch:
      summary: Désactive un module pour l'utilisateur
      tags:
        - Modules
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: ID du module à désactiver
          schema:
            type: string
      responses:
        "200":
          description: Module désactivé
  /news:
    get:
      summary: Récupère toutes les actualités
      tags:
        - News
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des actualités
    post:
      summary: Crée une nouvelle actualité (requiert "create_news")
      tags:
        - News
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - description
              properties:
                title:
                  type: string
                description:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
                date:
                  type: string
                  format: date
      responses:
        "201":
          description: Actualité créée
        "403":
          description: Permission refusée
  /news/{id}:
    get:
      summary: Récupère une actualité par son ID
      tags:
        - News
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID de l’actualité
          schema:
            type: string
      responses:
        "200":
          description: Actualité trouvée
        "404":
          description: Actualité non trouvée
    patch:
      summary: Met à jour une actualité par son ID (requiert "edit_news")
      tags:
        - News
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
                date:
                  type: string
                  format: date
      responses:
        "200":
          description: Actualité mise à jour
        "403":
          description: Permission refusée
        "404":
          description: Actualité non trouvée
    delete:
      summary: Supprime une actualité par son ID (requiert "delete_news")
      tags:
        - News
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Actualité supprimée
        "403":
          description: Permission refusée
        "404":
          description: Actualité non trouvée
  /permissions:
    get:
      summary: Récupère toutes les permissions (requiert "view_permissions")
      tags:
        - Permissions
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des permissions
    post:
      summary: Crée une nouvelle permission (requiert "create_permission")
      tags:
        - Permissions
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
      responses:
        "201":
          description: Permission créée
        "400":
          description: Données invalides
  /permissions/{id}:
    get:
      summary: Récupère une permission par ID (requiert "view_permissions")
      tags:
        - Permissions
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Permission trouvée
        "404":
          description: Permission non trouvée
    patch:
      summary: Met à jour une permission par ID (requiert "edit_permission")
      tags:
        - Permissions
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
      responses:
        "200":
          description: Permission mise à jour
        "404":
          description: Permission non trouvée
    delete:
      summary: Supprime une permission par ID (requiert "delete_permission")
      tags:
        - Permissions
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Permission supprimée
        "404":
          description: Permission non trouvée
  /robots:
    get:
      summary: Liste tous les robots liés à l'utilisateur connecté
      tags:
        - Robots
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des robots de l'utilisateur
    post:
      summary: Création complète d’un robot (requiert "create_robot")
      tags:
        - Robots
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - serialNumber
                - linkKey
                - model
                - firmware
                - color
                - controllable
              properties:
                serialNumber:
                  type: string
                linkKey:
                  type: string
                model:
                  type: string
                firmware:
                  type: string
                color:
                  type: string
                controllable:
                  type: boolean
      responses:
        "201":
          description: Robot créé
        "403":
          description: Permission refusée
  /robots/all:
    get:
      summary: Liste tous les robots existants (requiert "view_all_robots")
      tags:
        - Robots
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste de tous les robots
        "403":
          description: Permission refusée
  /robots/link:
    post:
      summary: Lier un robot existant à un utilisateur via n° de série + clé
      tags:
        - Robots
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - serialNumber
                - linkKey
                - name
              properties:
                serialNumber:
                  type: string
                linkKey:
                  type: string
                name:
                  type: string
      responses:
        "200":
          description: Robot lié avec succès
        "400":
          description: Données invalides
  /robots/{id}:
    get:
      summary: Détail d’un robot (admin ou propriétaire uniquement)
      tags:
        - Robots
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Données du robot
        "403":
          description: Accès refusé
        "404":
          description: Robot non trouvé
    put:
      summary: Modifier un robot (admin ou propriétaire uniquement)
      tags:
        - Robots
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                firmware:
                  type: string
                color:
                  type: string
                controllable:
                  type: boolean
      responses:
        "200":
          description: Robot mis à jour
        "403":
          description: Accès refusé
        "404":
          description: Robot non trouvé
    delete:
      summary: Supprimer un robot (admin ou propriétaire uniquement)
      tags:
        - Robots
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Robot supprimé
        "403":
          description: Accès refusé
        "404":
          description: Robot non trouvé
  /robots/import:
    post:
      summary: Importer plusieurs robots depuis un CSV (requiert "import_robots")
      tags:
        - Robots
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: Robots importés
        "400":
          description: Fichier invalide
        "403":
          description: Permission refusée
  /roles:
    get:
      summary: Liste tous les rôles
      tags:
        - Roles
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des rôles
        "403":
          description: Permission refusée
    post:
      summary: Crée un nouveau rôle
      tags:
        - Roles
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - permissions
              properties:
                name:
                  type: string
                permissions:
                  type: array
                  items:
                    type: string
      responses:
        "201":
          description: Rôle créé
        "403":
          description: Permission refusée
  /roles/{id}:
    get:
      summary: Récupère un rôle par ID
      tags:
        - Roles
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Rôle trouvé
        "403":
          description: Permission refusée
        "404":
          description: Rôle introuvable
    patch:
      summary: Met à jour un rôle
      tags:
        - Roles
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                permissions:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Rôle mis à jour
        "403":
          description: Permission refusée
        "404":
          description: Rôle introuvable
    delete:
      summary: Supprime un rôle
      tags:
        - Roles
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Rôle supprimé
        "403":
          description: Permission refusée
        "404":
          description: Rôle introuvable
  /upload/robot-image:
    post:
      summary: Upload d’image pour un robot
      tags:
        - Uploads
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "201":
          description: Image robot uploadée avec succès
        "403":
          description: Permission refusée
  /upload/news-image:
    post:
      summary: Upload d’image pour une actualité (éditeur Markdown)
      tags:
        - Uploads
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "201":
          description: Image actualité uploadée avec succès
        "403":
          description: Permission refusée
  /upload/firmware:
    post:
      summary: Upload d’un fichier firmware (.bin, .hex, .zip)
      tags:
        - Uploads
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "201":
          description: Firmware uploadé avec succès
        "403":
          description: Permission refusée
  /users/me:
    get:
      summary: Récupère les infos de l'utilisateur connecté
      tags:
        - Users
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Infos utilisateur récupérées
        "401":
          description: Non autorisé
    patch:
      summary: Met à jour le profil de l'utilisateur connecté
      tags:
        - Users
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                address:
                  type: string
                address2:
                  type: string
                zipCode:
                  type: string
                city:
                  type: string
                country:
                  type: string
      responses:
        "200":
          description: Profil mis à jour
        "401":
          description: Non autorisé
  /users/password:
    patch:
      summary: Met à jour le mot de passe de l'utilisateur connecté
      tags:
        - Users
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
      responses:
        "200":
          description: Mot de passe mis à jour
        "400":
          description: Erreur de validation
        "401":
          description: Non autorisé
  /users:
    get:
      summary: Liste tous les utilisateurs (requiert la permission "view_users")
      tags:
        - Users
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Liste des utilisateurs
        "403":
          description: Permission refusée
    post:
      summary: Crée un utilisateur (admin uniquement)
      tags:
        - Users
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstName
                - lastName
                - email
                - roleId
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                roleId:
                  type: string
      responses:
        "201":
          description: Utilisateur créé avec succès
        "400":
          description: Champs manquants ou email déjà utilisé
        "500":
          description: Erreur serveur
  /users/{id}:
    get:
      summary: Récupère un utilisateur par ID
      tags:
        - Users
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Utilisateur trouvé
        "403":
          description: Permission refusée
        "404":
          description: Utilisateur non trouvé
    patch:
      summary: Met à jour un utilisateur par ID
      tags:
        - Users
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                roleId:
                  type: string
      responses:
        "200":
          description: Utilisateur mis à jour
        "403":
          description: Accès interdit
        "500":
          description: Erreur serveur
    delete:
      summary: Supprime un utilisateur par ID
      tags:
        - Users
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Utilisateur supprimé
        "403":
          description: Permission refusée
        "500":
          description: Erreur serveur
tags:
  - name: Auth
    description: Authentification et gestion utilisateur
  - name: Download
    description: Téléchargement de fichiers
  - name: Logs
    description: Accès aux journaux système (admin uniquement)
  - name: Modules
    description: Gestion des modules utilisateur
  - name: News
    description: Gestion des actualités
  - name: Permissions
    description: Gestion des permissions (admin uniquement)
  - name: Robots
    description: Gestion des robots
  - name: Roles
    description: Gestion des rôles et permissions
  - name: Uploads
    description: Upload de fichiers (images, firmwares…)
  - name: Users
    description: Gestion des utilisateurs
